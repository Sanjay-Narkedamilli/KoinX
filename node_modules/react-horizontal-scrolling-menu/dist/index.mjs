import e from"react";const t="react-horizontal-scrolling-menu",n="-separator",o=`${t}-${n}`,r=`${t}--item`,s=`${t}--scroll-container`,i=`${t}--wrapper`,l=`${t}--inner-wrapper`,a=`${t}--header`,u=`${t}--arrow-left`,c=`${t}--arrow-right`,d=`${t}--footer`,h="itemId",v="data-key",f="data-index",m={first:"first",last:"last",onInit:"onInit",onUpdate:"onUpdate"};var p=Object.freeze({__proto__:null,rootClassName:t,separatorString:n,separatorClassName:o,itemClassName:r,scrollContainerClassName:s,wrapperClassName:i,innerWrapperClassName:l,headerClassName:a,arrowLeftClassName:u,arrowRightClassName:c,footerClassName:d,id:h,dataKeyAttribute:v,dataIndexAttribute:f,events:m});function b({className:t="",children:n,onScroll:o=(()=>{}),scrollRef:r}){const i=e.useMemo((()=>`${s} ${t}`),[t]);return e.createElement("div",{className:i,onScroll:o,ref:r},n)}var g=e.memo((function({className:t,id:n,index:o,refs:r}){const s=e.useRef(null);return r[o]=s,e.createElement("div",{className:t,[v]:n,[f]:o,ref:s})}));var y=e.memo((function({children:t,className:n,id:o,index:r,refs:s}){const i=e.useRef(null);return s[String(r)]=i,e.createElement("div",{className:n,[v]:o,[f]:r,ref:i},t)}));const w=e=>"object"==typeof e&&null!=e&&1===e.nodeType,E=(e,t)=>(!t||"hidden"!==e)&&"visible"!==e&&"clip"!==e,I=(e,t)=>{if(e.clientHeight<e.scrollHeight||e.clientWidth<e.scrollWidth){const n=getComputedStyle(e,null);return E(n.overflowY,t)||E(n.overflowX,t)||(e=>{const t=(e=>{if(!e.ownerDocument||!e.ownerDocument.defaultView)return null;try{return e.ownerDocument.defaultView.frameElement}catch(e){return null}})(e);return!!t&&(t.clientHeight<e.scrollHeight||t.clientWidth<e.scrollWidth)})(e)}return!1},C=(e,t,n,o,r,s,i,l)=>s<e&&i>t||s>e&&i<t?0:s<=e&&l<=n||i>=t&&l>=n?s-e-o:i>t&&l<n||s<e&&l>n?i-t+r:0,M=e=>{const t=e.parentElement;return null==t?e.getRootNode().host||null:t},N=(e,t)=>{var n,o,r,s;if("undefined"==typeof document)return[];const{scrollMode:i,block:l,inline:a,boundary:u,skipOverflowHiddenElements:c}=t,d="function"==typeof u?u:e=>e!==u;if(!w(e))throw new TypeError("Invalid target");const h=document.scrollingElement||document.documentElement,v=[];let f=e;for(;w(f)&&d(f);){if(f=M(f),f===h){v.push(f);break}null!=f&&f===document.body&&I(f)&&!I(document.documentElement)||null!=f&&I(f,c)&&v.push(f)}const m=null!=(o=null==(n=window.visualViewport)?void 0:n.width)?o:innerWidth,p=null!=(s=null==(r=window.visualViewport)?void 0:r.height)?s:innerHeight,{scrollX:b,scrollY:g}=window,{height:y,width:E,top:N,right:x,bottom:k,left:S}=e.getBoundingClientRect(),{top:$,right:R,bottom:W,left:B}=(e=>{const t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);let T="start"===l||"nearest"===l?N-$:"end"===l?k+W:N+y/2-$+W,j="center"===a?S+E/2-B+R:"end"===a?x+R:S-B;const O=[];for(let e=0;e<v.length;e++){const t=v[e],{height:n,width:o,top:r,right:s,bottom:u,left:c}=t.getBoundingClientRect();if("if-needed"===i&&N>=0&&S>=0&&k<=p&&x<=m&&N>=r&&k<=u&&S>=c&&x<=s)return O;const d=getComputedStyle(t),f=parseInt(d.borderLeftWidth,10),w=parseInt(d.borderTopWidth,10),I=parseInt(d.borderRightWidth,10),M=parseInt(d.borderBottomWidth,10);let $=0,R=0;const W="offsetWidth"in t?t.offsetWidth-t.clientWidth-f-I:0,B="offsetHeight"in t?t.offsetHeight-t.clientHeight-w-M:0,V="offsetWidth"in t?0===t.offsetWidth?0:o/t.offsetWidth:0,H="offsetHeight"in t?0===t.offsetHeight?0:n/t.offsetHeight:0;if(h===t)$="start"===l?T:"end"===l?T-p:"nearest"===l?C(g,g+p,p,w,M,g+T,g+T+y,y):T-p/2,R="start"===a?j:"center"===a?j-m/2:"end"===a?j-m:C(b,b+m,m,f,I,b+j,b+j+E,E),$=Math.max(0,$+g),R=Math.max(0,R+b);else{$="start"===l?T-r-w:"end"===l?T-u+M+B:"nearest"===l?C(r,u,n,w,M+B,T,T+y,y):T-(r+n/2)+B/2,R="start"===a?j-c-f:"center"===a?j-(c+o/2)+W/2:"end"===a?j-s+I+W:C(c,s,o,f,I+W,j,j+E,E);const{scrollLeft:e,scrollTop:i}=t;$=0===H?0:Math.max(0,Math.min(i+$/H,t.scrollHeight-n/H+B)),R=0===V?0:Math.max(0,Math.min(e+R/V,t.scrollWidth-o/V+W)),T+=i-$,j+=e-R}O.push({el:t,top:$,left:R})}return O};function x(e,t){if(!e.isConnected||!(e=>{let t=e;for(;t&&t.parentNode;){if(t.parentNode===document)return!0;t=t.parentNode instanceof ShadowRoot?t.parentNode.host:t.parentNode}return!1})(e))return;const n=(e=>{const t=window.getComputedStyle(e);return{top:parseFloat(t.scrollMarginTop)||0,right:parseFloat(t.scrollMarginRight)||0,bottom:parseFloat(t.scrollMarginBottom)||0,left:parseFloat(t.scrollMarginLeft)||0}})(e);if((e=>"object"==typeof e&&"function"==typeof e.behavior)(t))return t.behavior(N(e,t));const o="boolean"==typeof t||null==t?void 0:t.behavior;for(const{el:r,top:s,left:i}of N(e,(e=>!1===e?{block:"end",inline:"nearest"}:(e=>e===Object(e)&&0!==Object.keys(e).length)(e)?e:{block:"start",inline:"nearest"})(t))){const e=s-n.top+n.bottom,t=i-n.left+n.right;r.scroll({top:e,left:t,behavior:o})}}let k;const S=()=>(k||(k="performance"in window?performance.now.bind(performance):Date.now),k());function $(e){const t=S(),n=Math.min((t-e.startTime)/e.duration,1),o=e.ease(n),r=e.startX+(e.x-e.startX)*o,s=e.startY+(e.y-e.startY)*o;e.method(r,s,n,o),r!==e.x||s!==e.y?requestAnimationFrame((()=>$(e))):e.cb()}function R(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:600,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e=>1+--e*e*e*e*e,s=arguments.length>5?arguments[5]:void 0,i=arguments.length>6?arguments[6]:void 0;const l=e,a=e.scrollLeft,u=e.scrollTop;$({scrollable:l,method:(t,n,o,r)=>{const s=Math.ceil(t),l=Math.ceil(n);e.scrollLeft=s,e.scrollTop=l,null==i||i({target:e,elapsed:o,value:r,left:s,top:l})},startTime:S(),startX:a,startY:u,x:t,y:n,duration:o,ease:r,cb:s})}const W=function(e,t){const n=t||{};return(e=>e&&!e.behavior||"smooth"===e.behavior)(n)?x(e,{block:n.block,inline:n.inline,scrollMode:n.scrollMode,boundary:n.boundary,skipOverflowHiddenElements:n.skipOverflowHiddenElements,behavior:e=>Promise.all(e.reduce(((e,t)=>{let{el:o,left:r,top:s}=t;const i=o.scrollLeft,l=o.scrollTop;return i===r&&l===s?e:[...e,new Promise((e=>R(o,r,s,n.duration,n.ease,(()=>e({el:o,left:[i,r],top:[l,s]})),n.onScrollChange)))]}),[]))}):Promise.resolve(x(e,t))},B=e=>Object.values(e).map((e=>e.current)).filter(Boolean);function T(e,t,n,o,r,s){var i;const l=(null===(i=null==e?void 0:e.entry)||void 0===i?void 0:i.target)||e;if(!l)return;const a={behavior:t||"smooth",inline:n||"end",block:o||"nearest"};return s?l.scrollIntoView(a):W(l,Object.assign(Object.assign({},r),a))}const j=e=>document.querySelector(`[${v}='${e}']`),O=e=>document.querySelector(`[${f}='${e}']`);function V(t){return e.isValidElement(t)&&t||"function"==typeof t&&e.createElement(t,null)||!!t&&"object"==typeof t&&e.createElement(t,null)||null}const H=e=>e.filter((e=>!new RegExp(`.*${n}$`).test(e))),U=e=>{var t;return String((null===(t=null==e?void 0:e.props)||void 0===t?void 0:t[h])||String((null==e?void 0:e.key)||"").replace(/^\.\$/,""))};function A({children:t,itemClassName:s="",refs:i,separatorClassName:l=""}){const a=e.Children.toArray(t).filter(Boolean),u=a.length,c=e.useMemo((()=>`${r} ${s}`),[s]),d=e.useMemo((()=>`${o} ${l}`),[l]);return e.createElement(e.Fragment,null,a.map(((t,o)=>{const r=U(t),s="menuItem__"+r,l=r+n,a=o+1===u;return[e.createElement(y,{className:c,id:r,key:s,refs:i,index:o},t),!a&&e.createElement(g,{className:d,id:l,refs:i,key:l,index:o+.1})]})))}const L="undefined"!=typeof window?e.useLayoutEffect:e.useEffect;function F({items:t,itemsChanged:n,refs:o,options:r}){const s=e.useRef(),i=e.useCallback((e=>{t.setBatch(function(e,t){return[...e].map((e=>{var n,o,r,s;const i=e.target,l=String(null!==(o=null===(n=null==i?void 0:i.dataset)||void 0===n?void 0:n.key)&&void 0!==o?o:"");return[l,{index:String(null!==(s=null===(r=null==i?void 0:i.dataset)||void 0===r?void 0:r.index)&&void 0!==s?s:""),key:l,entry:e,visible:e.intersectionRatio>=t.ratio}]}))}(e,r))}),[t,r]);L((()=>{const e=B(o),t=s.current||new IntersectionObserver(i,r);return s.current=t,e.forEach((e=>t.observe(e))),()=>{t.disconnect(),s.current=void 0}}),[i,n,r,o])}const P=t=>e.Children.toArray(t).map(U).filter(Boolean);class D{constructor(){this.subscribe=(e,t)=>{this.observers.set(e,(this.observers.get(e)||[]).concat(t))},this.unsubscribe=(e,t)=>{const n=(this.observers.get(e)||[]).filter((e=>e!==t));n.length?this.observers.set(e,n):this.observers.delete(e)},this.emitUpdates=(e,t)=>{const n=this.observers.get(e)||[];null==n||n.forEach((e=>null==e?void 0:e(t)))},this.updateBatch=(e,t=!0)=>{e.length&&(e.forEach((([e,t])=>this.emitUpdates(e,t))),t&&this.emitUpdates(m.onUpdate))},this.update=(e,t)=>{this.emitUpdates(e,t),this.emitUpdates(m.onUpdate)},this.observers=new Map}}class _ extends Map{constructor(){super(),this.subscribe=(e,t)=>this.observer.subscribe(e,t),this.unsubscribe=(e,t)=>this.observer.unsubscribe(e,t),this.isEdgeItem=({key:e,value:t,first:n=this.first(),last:o=this.last()})=>{const r=[];return e===(null==n?void 0:n.key)?r.push([m.first,t]):e===(null==o?void 0:o.key)&&r.push([m.last,t]),r},this.edgeItemsCheck=e=>{const t=this.first(),n=this.last(),o=e.find((([e])=>e===(null==t?void 0:t.key))),r=[];o&&r.push([m.first,o[1]]);const s=e.find((([e])=>e===(null==n?void 0:n.key)));return s&&r.push([m.last,s[1]]),r},this.toArr=()=>this.sort([...this]),this.toItems=()=>this.toArr().map((([e])=>e)),this.toItemsWithoutSeparators=()=>H(this.toItems()),this.sort=e=>e.sort((([,e],[,t])=>+e.index-+t.index)),this.set=(e,t)=>{const n=String(e),o=[[n,t]];return super.set(n,t),o.push(...this.isEdgeItem({key:n,value:t,first:this.first(),last:this.last()})),this.observer.updateBatch(o),this},this.setBatch=e=>{this.firstRun&&this.observer.update(m.onInit);const t=[...e];return this.sort(t).forEach((([e,t])=>{super.set(String(e),t)})),t.push(...this.edgeItemsCheck(t)),this.observer.updateBatch(t,!this.firstRun),this.firstRun=!1,this},this.first=()=>{var e;return null===(e=this.toArr()[0])||void 0===e?void 0:e[1]},this.last=()=>{var e,t;return null===(t=null===(e=this.toArr().slice(-1))||void 0===e?void 0:e[0])||void 0===t?void 0:t[1]},this.filter=e=>this.toArr().filter(e),this.find=e=>this.toArr().find(e),this.findIndex=e=>this.toArr().findIndex(e),this.getCurrentPos=(e,t)=>{const o=this.toArr().filter((e=>{var o;return t?!(null===(o=null==e?void 0:e[0])||void 0===o?void 0:o.includes(n)):e})),r=o.findIndex((([t,n])=>t===e||n===e));return[o,r]},this.prev=(e,t)=>{var n;const[o,r]=this.getCurrentPos(e,!!t);return-1!==r?null===(n=o[r-1])||void 0===n?void 0:n[1]:void 0},this.next=(e,t)=>{var n;const[o,r]=this.getCurrentPos(e,!!t);return-1!==r?null===(n=o[r+1])||void 0===n?void 0:n[1]:void 0},this.getVisible=()=>this.filter((e=>e[1].visible)),this.getVisibleElements=()=>this.filter((e=>!e[0].includes(n)&&e[1].visible)),this.observer=new D,this.firstRun=!0}}const X={ratio:.9,rootMargin:"5px",threshold:[.05,.5,.75,.95]},Y=e.createContext({}),q=e=>e.reduce(((e,t)=>e.concat(t).concat(`${t}${n}`)),[]).slice(0,-1);function z(e,t){const n=H(e),o=H(t);return{prev:()=>q(function(e,t){const n=e.findIndex((e=>e===(null==t?void 0:t[0]))),o=t.length,r=n-o,s=r<0,i=s?0:r,l=e.slice(i,s?o:n);return l.length===o?l:e.slice(n,o)}(n,o)),next:()=>q(function(e,t){const n=e.findIndex((e=>{var n;return e===(null===(n=t.slice(-1))||void 0===n?void 0:n[0])})),o=t.length,r=n+o+1,s=r>e.length-1,i=s?e.length-1:r,l=e.slice(s?i-o+1:n+1,i);return l.length===o?l:e.slice(e.length-o,e.length+o)}(n,o))}}const K=e=>{var t;const o=(e=>e.filter(((e,t,o)=>{const r=0===t,s=t===o.length-1,i=new RegExp(n).test(e);return!((r||s)&&i)})))(e),r=o[Math.floor(o.length/2)];return{first:null==o?void 0:o[0],center:r,last:null===(t=o.slice(-1))||void 0===t?void 0:t[0]}},G={current:{}},J=()=>{};function Q({LeftArrow:t,RightArrow:o,children:r,Header:s,Footer:h,transitionDuration:v=500,transitionBehavior:f,onInit:p=J,onUpdate:g=J,onMouseDown:y,onMouseUp:w,onMouseMove:E,onScroll:I=J,onTouchMove:C,onTouchStart:M,onTouchEnd:N,onWheel:x=J,options:k=X,scrollContainerClassName:S="",itemClassName:$="",separatorClassName:R="",wrapperClassName:W="",apiRef:B=G,RTL:H,noPolyfill:U}){const L=V(t),D=V(o),q=V(s),z=V(h),K=e.useRef(null),[Q]=e.useState({}),Z=e.useMemo((()=>Object.assign(Object.assign(Object.assign({},X),k),{root:K.current})),[k]),ee=e.useRef(new _).current,te=function(t,o){const[r,s]=e.useState(""),i=e.useMemo((()=>P(t)),[t]);return e.useEffect((()=>{const e=i.filter(Boolean).join("");o.toItemsWithoutSeparators().filter((e=>!i.includes(e))).forEach((e=>{var t,r;const s=(null===(t=o.last())||void 0===t?void 0:t.key)===e&&(null===(r=o.prev(e))||void 0===r?void 0:r.key)||"";o.delete(s),o.delete(`${e}${n}`),o.delete(e)})),s(e)}),[i,o]),r}(r,ee);F(e.useMemo((()=>({items:ee,itemsChanged:te,options:Z,refs:Q})),[ee,te,Q,Z]));const ne=e.useMemo((()=>function(t,n,o){var r,s,i;const l=!!(null===(r=t.first())||void 0===r?void 0:r.visible),a=!!(null===(s=t.last())||void 0===s?void 0:s.visible),u=e=>{var n;return null===(n=t.find((t=>t[1].key===String(e))))||void 0===n?void 0:n[1]},c=()=>{var e,n;const o=null===(n=null===(e=t.getVisible())||void 0===e?void 0:e[0])||void 0===n?void 0:n[1];return o?t.prev(o):void 0},d=()=>{var e;const n=null===(e=t.getVisible().findLast((()=>!0)))||void 0===e?void 0:e[1];return n?t.next(n):void 0},h=null===(i=null==n?void 0:n.boundary)||void 0===i?void 0:i.current;return{getItemById:u,getItemElementById:j,getItemByIndex:e=>{var n;return null===(n=t.find((t=>String(t[1].index)===String(e))))||void 0===n?void 0:n[1]},getItemElementByIndex:O,getNextItem:d,getNextElement:()=>{var e;const n=null===(e=t.getVisibleElements().findLast((()=>!0)))||void 0===e?void 0:e[1];return n?t.next(n,!0):void 0},getPrevItem:c,getPrevElement:()=>{var e,n;const o=null===(n=null===(e=t.getVisibleElements())||void 0===e?void 0:e[0])||void 0===n?void 0:n[1];return o?t.prev(o,!0):void 0},isFirstItemVisible:l,isItemVisible:e=>t.getVisibleElements().map((e=>e[0])).includes(String(e)),isLastItem:e=>t.last()===u(e),isLastItemVisible:a,scrollNext:(e,t,r,{duration:s,boundary:i=h}={})=>{const l=null!=e?e:null==n?void 0:n.behavior;return T(d(),l,t||"start",r||"nearest",{boundary:i,duration:null!=s?s:null==n?void 0:n.duration},o)},scrollPrev:(e,t,r,{duration:s,boundary:i=h}={})=>{const l=null!=e?e:null==n?void 0:n.behavior;return T(c(),l,t||"end",r||"nearest",{boundary:i,duration:null!=s?s:null==n?void 0:n.duration},o)},useIsVisible:(n,o=!1)=>{const[r,s]=e.useState(o);return e.useEffect((()=>{const e=e=>{s(!!(null==e?void 0:e.visible))};return t.subscribe(n,e),()=>{t.unsubscribe(n,e)}}),[n]),r},scrollToItem:(e,t,r,s,i)=>{var l;return T(e,null!=t?t:null==n?void 0:n.behavior,r,s,Object.assign(Object.assign({boundary:h},i),{duration:null!==(l=null==i?void 0:i.duration)&&void 0!==l?l:null==n?void 0:n.duration}),o)}}}(ee,{duration:v,behavior:f,boundary:K},U)),[ee,v,f,U]),oe=e.useCallback((()=>Object.assign(Object.assign({},ne),{items:ee,scrollContainer:K})),[ne,ee,K]),[re,se]=e.useState((()=>oe()));(({context:t,onInit:n,onUpdate:o})=>{e.useEffect((()=>{const e=()=>n(t),r=()=>o(t);return t.items.subscribe(m.onInit,e),t.items.subscribe(m.onUpdate,r),()=>{t.items.unsubscribe(m.onInit,e),t.items.unsubscribe(m.onUpdate,r)}}),[t,n,o])})({context:re,onInit:p,onUpdate:g}),e.useEffect((()=>se(oe())),[oe]),B.current=re;const ie=e.useCallback((e=>I(re,e)),[I,re]),le=e.useCallback((e=>x(re,e)),[x,re]),ae=e.useMemo((()=>`${i} ${W}`),[W]),ue=e.useMemo((()=>`${S}${H?" rtl":""}`),[H,S]);return e.createElement("div",{className:ae,onWheel:le,onMouseDown:null==y?void 0:y(re),onMouseUp:null==w?void 0:w(re),onMouseMove:null==E?void 0:E(re),onTouchStart:null==M?void 0:M(re),onTouchMove:null==C?void 0:C(re),onTouchEnd:null==N?void 0:N(re)},e.createElement(Y.Provider,{value:re},e.createElement("div",{className:a},q),e.createElement("div",{className:l},e.createElement("div",{className:u},L),e.createElement(b,{className:ue,onScroll:ie,scrollRef:K},e.createElement(A,{refs:Q,itemClassName:$,separatorClassName:R},r)),e.createElement("div",{className:c},D)),e.createElement("div",{className:d},z)))}export{Q as ScrollMenu,Y as VisibilityContext,p as constants,K as getItemsPos,z as slidingWindow};
